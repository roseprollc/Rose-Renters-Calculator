"use strict";(()=>{var e={};e.id=8940,e.ids=[8940],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},52367:(e,r,s)=>{let t,i;s.r(r),s.d(r,{headerHooks:()=>v,originalPathname:()=>T,patchFetch:()=>_,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>g,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>q});var a={};s.r(a),s.d(a,{GET:()=>m,POST:()=>f});var n=s(95419),o=s(69108),u=s(99678),d=s(78070),l=s(40489);let p=require("node:crypto");var c=s(49605),h=s(4118),y=s(7439);async function m(e,{params:r}){if(!(0,y.cookies)().get("auth_token"))return d.Z.json({error:"Unauthorized"},{status:401});try{let e=await l._.analysis.findFirst({where:{publicId:r.id},include:{versions:{orderBy:{createdAt:"desc"},take:1}}});if(!e)return d.Z.json({error:"Analysis not found"},{status:404});let s={type:e.type,data:e.data,propertyAddress:e.propertyAddress,versions:e.versions,createdAt:e.createdAt};return d.Z.json({analysis:s})}catch(e){return console.error("Error fetching shared analysis:",e),d.Z.json({error:"Internal Server Error"},{status:500})}}async function f(e,{params:r}){try{let e=await (0,c.getServerSession)(h.authOptions);if(!e?.user)return d.Z.json({error:"Unauthorized"},{status:401});let s=await l._.analysis.findFirst({where:{id:r.id,userId:e.user.id}});if(!s)return d.Z.json({error:"Analysis not found"},{status:404});if(!s.publicId){let e=await l._.analysis.update({where:{id:r.id},data:{publicId:function(e=21){var r;r=e|=0,!t||t.length<r?(t=Buffer.allocUnsafe(128*r),p.webcrypto.getRandomValues(t),i=0):i+r>t.length&&(p.webcrypto.getRandomValues(t),i=0),i+=r;let s="";for(let r=i-e;r<i;r++)s+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&t[r]];return s}(10),isPublic:!0}}),s=`${process.env.NEXT_PUBLIC_APP_URL}/shared/analysis/${e.publicId}`;return d.Z.json({publicUrl:s})}let a=`${process.env.NEXT_PUBLIC_APP_URL}/shared/analysis/${s.publicId}`;return d.Z.json({publicUrl:a})}catch(e){return console.error("Share analysis error:",e),d.Z.json({error:"Failed to share analysis"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analysis/shared/[id]/route",pathname:"/api/analysis/shared/[id]",filename:"route",bundlePath:"app/api/analysis/shared/[id]/route"},resolvedPagePath:"/Users/wolf/bnb-calc-clone/app/api/analysis/shared/[id]/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:b,serverHooks:g,headerHooks:v,staticGenerationBailout:q}=w,T="/api/analysis/shared/[id]/route";function _(){return(0,u.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:b})}},4118:(e,r,s)=>{s.r(r),s.d(r,{GET:()=>p,POST:()=>p,authOptions:()=>l});var t=s(81355),i=s.n(t),a=s(10375),n=s(86485),o=s(6521),u=s.n(o),d=s(40489);let l={providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({id:"credentials",name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},mode:{label:"Mode",type:"text"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Missing credentials");let{email:r,password:s,mode:t}=e;if("demo@example.com"===r&&"demo123"===s)return{id:"demo",email:"demo@example.com",name:"Demo User",subscriptionTier:"free"};if("signup"===t){if(await d._.user.findUnique({where:{email:r}}))throw Error("User already exists");let e=await u().hash(s,10),t=await d._.user.create({data:{email:r,password:e,subscriptionTier:"free"}});return{id:t.id,email:t.email,subscriptionTier:t.subscriptionTier}}let i=await d._.user.findUnique({where:{email:r}});if(!i)throw Error("No user found with this email");if(!await u().compare(s,i.password))throw Error("Invalid password");return{id:i.id,email:i.email,subscriptionTier:i.subscriptionTier}}})],session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/login",error:"/login"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.subscriptionTier=r.subscriptionTier||"free"),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.subscriptionTier=r.subscriptionTier),e)}},p=i()(l)},40489:(e,r,s)=>{s.d(r,{_:()=>i});let t=require("@prisma/client"),i=globalThis.prisma??new t.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1638,6206,7439,3561],()=>s(52367));module.exports=t})();
"use strict";(()=>{var e={};e.id=2760,e.ids=[2760],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},62173:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>k,originalPathname:()=>P,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>q});var a={};r.r(a),r.d(a,{POST:()=>w});var s=r(95419),o=r(69108),i=r(99678),n=r(78070);let d=require("puppeteer");var l=r.n(d);let c=e=>{let t=e.match(/\b\d{5}\b/);return t?t[0]:""},u=e=>!!(e.price&&e.address);async function p(e){try{return{avgDailyRate:null,avgCleaningFee:null,avgOccupancyRate:65}}catch(e){return console.error("Error fetching zipcode averages:",e),null}}let f=e=>{let t=e.match(/\d+(\.\d+)?/);return t?parseFloat(t[0]):0},b=e=>e?parseFloat(e.replace(/[^\d,.]/g,"").replace(/,/g,"")):0;async function g(e=3){let t=null;for(let r=1;r<=e;r++)try{console.log(`Browser setup attempt ${r} of ${e}`);let t=await l().launch({headless:"new",args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--disable-gpu","--window-size=1920,1080","--disable-web-security","--disable-features=IsolateOrigins,site-per-process","--disable-extensions","--disable-default-apps","--disable-popup-blocking","--disable-notifications","--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-component-extensions-with-background-pages","--disable-features=TranslateUI,BlinkGenPropertyTrees","--disable-ipc-flooding-protection","--disable-renderer-backgrounding","--enable-features=NetworkService,NetworkServiceInProcess","--metrics-recording-only","--no-first-run","--password-store=basic","--use-mock-keychain","--force-device-scale-factor=1","--hide-scrollbars","--mute-audio"],ignoreHTTPSErrors:!0,timeout:3e4}),a=await t.newPage();return await a.close(),t}catch(s){if(console.error(`Browser setup attempt ${r} failed:`,t=s instanceof Error?s:Error("Unknown error during browser setup")),r===e)throw t;let a=Math.min(1e3*Math.pow(2,r-1),1e4);console.log(`Waiting ${a}ms before retry...`),await new Promise(e=>setTimeout(e,a))}throw t}async function w(e){let t=null,r=null;try{let{url:a}=await e.json();if(!a)return n.Z.json({error:"URL is required"},{status:400});if(!a.includes("redfin.com")&&!a.includes("realtor.com"))return n.Z.json({error:"Unsupported website. Please use Redfin or Realtor.com links.",unsupported:!0},{status:400});try{new URL(a)}catch(e){return n.Z.json({error:"Invalid URL format",details:"Please provide a valid URL"},{status:400})}try{t=await g(),r=await t.newPage(),await r.setDefaultNavigationTimeout(3e4),await r.setViewport({width:1920,height:1080}),await r.setRequestInterception(!0),r.on("request",e=>{let t=e.resourceType();["image","stylesheet","font","media"].includes(t)?e.abort():e.continue()});let e=!1,s=null;for(let t=1;t<=3;t++)try{await r.goto(a,{waitUntil:"networkidle0",timeout:3e4}),e=!0;break}catch(e){s=e instanceof Error?e:Error("Unknown navigation error"),console.error(`Navigation attempt ${t} failed:`,s),t<3&&await new Promise(e=>setTimeout(e,1e3*t))}if(!e)throw Error(`Failed to navigate to URL after 3 attempts: ${s?.message}`);let o={price:0,address:""};if(a.includes("redfin.com"))for(let[e,t]of Object.entries({price:[".statsValue",".price",'[data-testid="price"]'],address:[".homeAddressV3",".address",'[data-testid="address"]'],beds:[".beds",'[data-testid="beds"]'],baths:[".baths",'[data-testid="baths"]'],sqft:[".sqFt",'[data-testid="sqft"]']}))for(let a of t)try{let t=await r.$(a);if(t){let r=await t.evaluate(e=>e.textContent||"");if(r){"price"===e?o.price=b(r):"address"===e?o.address=r.trim():"beds"===e?o.beds=f(r):"baths"===e?o.baths=f(r):"sqft"===e&&(o.sqft=f(r));break}}}catch(t){console.error(`Error extracting ${e}:`,t)}else if(a.includes("realtor.com"))for(let[e,t]of Object.entries({price:['[data-testid="price"]',".price"],address:['[data-testid="address"]',".address"],beds:['[data-testid="property-meta-beds"]',".beds"],baths:['[data-testid="property-meta-baths"]',".baths"],sqft:['[data-testid="property-meta-sqft"]',".sqft"]}))for(let a of t)try{let t=await r.$(a);if(t){let r=await t.evaluate(e=>e.textContent||"");if(r){"price"===e?o.price=b(r):"address"===e?o.address=r.trim():"beds"===e?o.beds=f(r):"baths"===e?o.baths=f(r):"sqft"===e&&(o.sqft=f(r));break}}}catch(t){console.error(`Error extracting ${e}:`,t)}if(!u(o))throw Error("Failed to extract required property data. Please try again or enter the information manually.");let i=c(o.address),d=i?await p(i):null;return n.Z.json({...o,averages:d})}catch(e){return console.error("Scraping error:",e),n.Z.json({error:e instanceof Error?e.message:"Failed to scrape property data",details:e instanceof Error?e.stack:void 0},{status:500})}finally{if(r)try{await r.close()}catch(e){console.error("Error closing page:",e)}if(t)try{await t.close()}catch(e){console.error("Error closing browser:",e)}}}catch(e){return console.error("Request error:",e),n.Z.json({error:"Invalid request",details:e instanceof Error?e.message:"Unknown error"},{status:400})}}let h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/scrape/route",pathname:"/api/scrape",filename:"route",bundlePath:"app/api/scrape/route"},resolvedPagePath:"/Users/wolf/bnb-calc-clone/app/api/scrape/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:v,headerHooks:k,staticGenerationBailout:q}=h,P="/api/scrape/route";function E(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206],()=>r(62173));module.exports=a})();